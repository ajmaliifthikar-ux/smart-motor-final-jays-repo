generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  password      String?
  role          String    @default("CUSTOMER")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?
  accounts      Account[]
  bookings      Booking[]
  sessions      Session[]
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Booking {
  id           String   @id @default(cuid())
  userId       String?
  guestName    String?
  guestEmail   String?
  guestPhone   String?
  vehicleBrand String?
  vehicleModel String?
  serviceId    String
  date         DateTime
  slot         String
  status       String   @default("PENDING")
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  service      Service  @relation(fields: [serviceId], references: [id])
  user         User?    @relation(fields: [userId], references: [id])

  @@unique([date, slot])
}

model Service {
  id                  String    @id @default(cuid())
  slug                String    @unique
  name                String
  nameAr              String
  description         String
  descriptionAr       String?
  detailedDescription String?
  category            String?
  basePrice           Float?
  duration            String
  icon                String?
  iconImage           String?
  image               String?
  process             String?
  subServices         String?
  seo                 String?
  isEnabled           Boolean   @default(true)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  bookings            Booking[]
}

model Brand {
  id          String   @id @default(cuid())
  slug        String?  @unique
  name        String   @unique
  nameAr      String?
  category    String?
  logoUrl     String?
  logoFile    String?
  heroImage   String?
  color       String?
  description String?
  heritage    String?
  heritageAr  String?
  models      String?
  specialties String?
  services    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ServicePackage {
  id            String   @id @default(cuid())
  title         String
  subtitle      String?
  isPromotional Boolean  @default(false)
  bestFor       String?
  features      String?
  validity      String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model BlogPost {
  id          String    @id @default(cuid())
  slug        String    @unique
  title       String
  excerpt     String
  content     String
  image       String?
  author      String?
  category    String?
  publishedAt DateTime?
  isPublished Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model FAQ {
  id         String   @id @default(cuid())
  question   String
  questionAr String?
  answer     String
  answerAr   String?
  category   String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model ContentBlock {
  key       String   @id
  value     String
  valueAr   String?
  type      String   @default("text")
  status    String   @default("PUBLISHED")
  parentKey String?
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Article {
  id          String   @id @default(cuid())
  slug        String   @unique
  title       String
  content     String
  seoTitle    String?
  seoDesc     String?
  keywords    String?
  isPublished Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model DocumentEmbedding {
  id        String   @id @default(cuid())
  content   String
  metadata  String?
  createdAt DateTime @default(now())
}

model IntegrationTrace {
  id        String   @id @default(cuid())
  service   String   // e.g., "Firebase", "Gemini", "Redis", "Resend"
  operation String   // e.g., "auth_verify", "generate_content", "cache_set"
  status    String   // "SUCCESS" | "FAILURE"
  duration  Int      // milliseconds
  error     String?  // Error message if FAILURE
  metadata  String?  // JSON string for extra context
  timestamp DateTime @default(now())

  @@index([service])
  @@index([status])
  @@index([timestamp])
}

model AuditLog {
  id        String   @id @default(cuid())
  userId    String
  action    String
  resource  String?
  details   String?
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([action])
}

model AIUsageLog {
  id         String   @id @default(cuid())
  userId     String
  action     String
  model      String
  prompt     String?
  tokenCount Int?
  cost       Float?
  createdAt  DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
}

model AnalyticsLog {
  id        String   @id @default(cuid())
  eventType String
  resource  String?
  emirate   String?
  city      String?
  device    String?
  browser   String?
  ipHash    String?
  metadata  String?
  createdAt DateTime @default(now())

  @@index([eventType])
  @@index([emirate])
  @@index([createdAt])
}

model SEOReport {
  id              String   @id @default(cuid())
  url             String
  score           Int
  technicalLogs   String?
  onPageLogs      String?
  contentLogs     String?
  recommendations String?
  createdAt       DateTime @default(now())

  @@index([url])
  @@index([createdAt])
}

model Subscriber {
  id        String   @id @default(cuid())
  email     String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ContentAudit {
  id            String   @id @default(cuid())
  key           String
  entityType    String
  previousValue String?
  newValue      String?
  updatedBy     String
  timestamp     DateTime @default(now())

  @@index([key])
  @@index([entityType])
}

model ContentHistory {
  id           String   @id @default(cuid())
  key          String
  entityType   String
  snapshot     String
  versionLabel String?
  createdBy    String
  createdAt    DateTime @default(now())

  @@index([key])
  @@index([entityType])
}
